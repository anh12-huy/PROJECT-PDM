<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Attendance System - Login</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/api.js"></script>
</head>

<body>
    <div class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1>üè¢ Attendance</h1>
                <p>Employee Attendance Management System</p>
            </div>

            <div class="login-tabs">
                <button class="tab-btn active" data-tab="login">Login</button>
                <button class="tab-btn" data-tab="register">Register</button>
            </div>

            <!-- LOGIN FORM -->
            <div id="login" class="tab-content active">
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="login-username">Employee ID</label>
                        <input type="text" id="login-username" placeholder="Enter your Employee ID" required>
                    </div>

                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>

                    <div class="remember-forgot">
                        <label class="checkbox">
                            <input type="checkbox">
                            <span>Remember me</span>
                        </label>
                        <a href="#">Forgot password?</a>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
                </form>
                <div id="loginMessage"></div>
            </div>

            <!-- REGISTER FORM -->
            <div id="register" class="tab-content">
                <form class="register-form" id="registerForm">
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" placeholder="Create a username" required>
                    </div>

                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" placeholder="Create a strong password" required>
                    </div>

                    <div class="form-group">
                        <label for="register-role">Role</label>
                        <select id="register-role" required>
                            <option value="">Select a role</option>
                            <option value="Employee">Employee</option>
                            <option value="Manager">Manager</option>
                        </select>
                    </div>

                    <div class="remember-forgot">
                        <label class="checkbox">
                            <input type="checkbox" required>
                            <span>I agree to the terms</span>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-success btn-block btn-lg">Create Account</button>
                </form>
                <div id="registerMessage"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { apiLogin } from "./js/api.js";

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;

                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-btn').forEach(b => {
                    b.classList.remove('active');
                });

                // Show selected tab
                document.getElementById(tabName).classList.add('active');
                btn.classList.add('active');
            });
        });

        // Login form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const messageDiv = document.getElementById('loginMessage');

            try {
                const res = await apiLogin("/auth/login", { username, password });

                if (res.token) {
                    messageDiv.innerHTML = '<div class="alert alert-success">‚úì Login successful! Redirecting...</div>';
                    localStorage.setItem("token", res.token);
                    localStorage.setItem("userId", res.userId);
                    const user = res.user || { userId: res.userId, username: username };
                    localStorage.setItem("user", JSON.stringify(user));
                    setTimeout(() => {
                        window.location.href = "Dashboard.html";
                    }, 1000);
                } else {
                    messageDiv.innerHTML = '<div class="alert alert-error">‚úó ' + (res.message || 'Login failed') + '</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="alert alert-error">‚úó ' + error.message + '</div>';
            }
        });

        // Register form
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const role = document.getElementById('register-role').value;
            const messageDiv = document.getElementById('registerMessage');

            try {
                const res = await apiLogin("/auth/register", { username, password, role });

                if (res.token) {
                    messageDiv.innerHTML = '<div class="alert alert-success">‚úì Registration successful! Logging you in...</div>';
                    localStorage.setItem("token", res.token);
                    localStorage.setItem("userId", res.userId);
                    const user = res.user || { userId: res.userId, username: username };
                    localStorage.setItem("user", JSON.stringify(user));
                    setTimeout(() => {
                        window.location.href = "Dashboard.html";
                    }, 1500);
                } else {
                    messageDiv.innerHTML = '<div class="alert alert-error">‚úó ' + (res.message || 'Registration failed') + '</div>';
                }
            } catch (error) {
                messageDiv.innerHTML = '<div class="alert alert-error">‚úó ' + error.message + '</div>';
            }
        });
    </script>
</body>

</html>